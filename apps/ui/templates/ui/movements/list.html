{% extends "ui/base.html" %}
{% block title %}Movimientos | Control de Inventarios{% endblock %}

{% block content %}
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h1 class="h4 mb-1">Movimientos</h1>
      <div class="text-secondary">Ingresos y egresos con comprobante PDF</div>
    </div>
    <a class="btn btn-dark" href="{% url 'ui:movements_create' %}">Nuevo movimiento</a>
  </div>

  {% if messages %}
    {% for m in messages %}
      <div class="alert alert-success py-2">{{ m }}</div>
    {% endfor %}
  {% endif %}

  <div class="table-responsive card shadow-sm">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Fecha</th>
          <th>Tipo</th>
          <th>Cliente</th>
          <th>Sucursal</th>
          <th>Almacén</th>
          <th>Producto</th>
          <th class="text-end">Cantidad</th>
          <th class="text-end">Stock antes</th>
          <th class="text-end">Stock después</th>
          <th class="text-end">PDF</th>
        </tr>
      </thead>
      <tbody>
        {% for mv in movements %}
          <tr>
            <td class="text-secondary">{{ mv.occurred_at|date:"Y-m-d H:i" }}</td>
            <td>
              {% if mv.movement_type == "IN" %}
                <span class="badge text-bg-success">Ingreso</span>
              {% else %}
                <span class="badge text-bg-danger">Egreso</span>
              {% endif %}
            </td>
            <td class="fw-semibold">{{ mv.warehouse.branch.customer.name }}</td>
            <td>{{ mv.warehouse.branch.name }}</td>
            <td>{{ mv.warehouse.name }}</td>
            <td>{{ mv.product }}</td>
            <td class="text-end">{{ mv.quantity }}</td>
            <td class="text-end text-secondary">{{ mv.stock_before }}</td>
            <td class="text-end fw-semibold">{{ mv.stock_after }}</td>
            <td class="text-end">
              {% if mv.pdf %}
                <a class="btn btn-sm btn-outline-dark" href="{% url 'ui:movements_pdf' mv.id %}">Descargar</a>
              {% else %}
                <span class="text-secondary"></span>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="10" class="text-center text-secondary py-4">No hay movimientos aún.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
